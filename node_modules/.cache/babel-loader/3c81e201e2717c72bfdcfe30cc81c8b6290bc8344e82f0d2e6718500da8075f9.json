{"ast":null,"code":"import { gantt } from 'dhtmlx-gantt';\nimport \"dhtmlx-gantt/codebase/dhtmlxgantt.css\";\nexport default {\n  name: 'gantt',\n  props: {\n    mainData: Array\n  },\n  data() {\n    return {\n      mainGanttData: {\n        data: [],\n        links: []\n      },\n      // demo数据\n      mainGanttData: {\n        data: [{\n          id: \"client\",\n          text: \"客户端\",\n          start_date: \"2020-4-12\",\n          demand: \"-\",\n          duration: 3\n        }, {\n          id: \"web\",\n          text: \"Web开发组\",\n          start_date: \"2020-4-12\",\n          demand: \"-\",\n          duration: 1,\n          parent: \"client\"\n        }, {\n          id: \"sakurahuang\",\n          text: \"sakurahuang\",\n          start_date: \"2020-4-12\",\n          demand: \"联系我小程序插件的cgi从node迁移到hiweb\",\n          duration: 1,\n          parent: \"web\"\n        }, {\n          id: \"sakurahuang1\",\n          text: \"\",\n          start_date: \"2020-4-12\",\n          demand: \"自研白板\",\n          duration: 1,\n          parent: \"sakurahuang\"\n        }, {\n          id: \"tdreamhuang\",\n          text: \"tdreamhuang\",\n          start_date: \"2020-4-12\",\n          demand: \"联系我小程序插件的cgi从node迁移到hiweb\",\n          duration: 1,\n          parent: \"web\"\n        }],\n        links: []\n      }\n    };\n  },\n  mounted() {\n    this.handleGantt();\n  },\n  watch: {\n    mainData() {\n      this.handleGantt();\n    }\n  },\n  methods: {\n    handleGantt() {\n      this.mainGanttData[\"data\"] = this.mainData;\n      const self = this;\n      // 这里设置左边列的标题，宽度，标题对齐方式\n      gantt.config.columns = [{\n        name: \"text\",\n        label: \"所属中心\",\n        align: \"left\",\n        width: 200,\n        tree: true,\n        template: function (obj) {\n          return obj.text;\n        }\n      }, {\n        name: \"text\",\n        label: \"标题/备注\",\n        align: \"center\",\n        width: 200,\n        template: function (obj) {\n          if (obj.demand) {\n            return `<a href=\"${obj.storylink}\" target=\"_blank\">${obj.demand}</a>`;\n          }\n        }\n      }];\n      // 禁用红色弹框\n      gantt.config.show_errors = false;\n      // 只读模式\n      gantt.config.readonly = true;\n      // 设置日期格式，以及步长\n      gantt.config.xml_date = \"%Y-%m-%d\";\n      gantt.config.date_scale = \"%Y-%m\";\n      gantt.config.subscales = [{\n        unit: \"day\",\n        step: 1,\n        date: \"%d\"\n      }];\n      gantt.config.duration_unit = \"day\";\n      gantt.config.duration_step = 1;\n\n      // 使用气泡和竖线要在这里加配置\n      gantt.plugins({\n        tooltip: true,\n        marker: true\n      });\n      gantt.init(this.$refs.gantt);\n      // console.log(\"mainGanttData\");\n      // console.log(this.mainGanttData);\n      // 这里要清一下，不然2个版本互切的时候，任务会相互影响\n      gantt.clearAll();\n      gantt.parse(this.mainGanttData);\n      if (this.mainGanttData.data.length === 0) {\n        gantt.clearAll();\n      }\n      gantt.eachTask(function (task) {\n        task.$open = true;\n      });\n      gantt.render();\n      // 设置柱形工作条颜色和文字\n      this.setGanttTaskCSS(gantt);\n      // 设置鼠标悬浮气泡\n      this.setGanttTooltip(gantt);\n\n      // 设置竖线\n      this.setGanttMarker(gantt);\n\n      // gantt.attachEvent(\"onError\", function (errorMessage) {\n      //   debugger;\n      //   return true;\n      // });\n    },\n\n    setGanttTaskCSS(gantt) {\n      gantt.templates.task_text = function (start, end, task) {\n        if (task.func_cnt || task.func_cnt === 0) {\n          return `功能需求&技术需求：${task.func_cnt}个，工时： ${task.work_time} d`;\n        } else {\n          return \"工时\" + task.work_time + \"d\";\n        }\n        // return \"<b>Text:</b> \"+task.text+\",<b> Holders:</b> \"+task.users;\n      };\n\n      gantt.templates.task_class = function (start, end, task) {\n        if (task.func_cnt || task.func_cnt === 0) {\n          return \"gantt_group_task_color\";\n        }\n      };\n    },\n    setGanttTooltip(gantt) {\n      const self = this;\n      gantt.templates.tooltip_text = function (start, end, task) {\n        // https://docs.dhtmlx.com/chart__dhxtooltip.html\n        if (task.type === \"client\") {\n          return self.handleTooltipClient(task);\n        } else if (task.type === \"group\") {\n          return self.groupToolTip(task);\n        }\n      };\n    },\n    setGanttMarker(gantt) {\n      gantt.addMarker({\n        start_date: new Date(),\n        css: \"gantt_today_marker\",\n        text: \"今日\"\n      });\n      if (this.ganttObj.ted_time) {\n        gantt.addMarker({\n          start_date: new Date(this.ganttObj.ted_time),\n          css: \"gantt_GM_Exper_marker\",\n          text: \"ted体验\"\n        });\n      }\n    },\n    handleTooltipClient(task) {\n      let tpl = `<header style=\"display: flex;\">\n        <section style=\"width: 100px;\"></section>\n        <section style=\"width: 40px;\">功能</section>\n        <section style=\"width: 40px;\">技术</section>\n        <section style=\"width: 40px;\">其他</section>\n        <section style=\"width: 40px;\">bug</section>\n    </header>\n    <section style=\"display: flex;\">\n        <section style=\"width: 100px;margin-right:5px;\">总和</section>\n        <section style=\"width: 40px;\">${task.func_cnt}</section>\n        <section style=\"width: 40px;\">${task.tech_cnt}</section>\n        <section style=\"width: 40px;\">${task.other_cnt}</section>\n        <section style=\"width: 40px;\">${task.bug_cnt}</section>\n    </section>`;\n      if (task.groupInfo && task.groupInfo.length > 0) {\n        task.groupInfo.forEach(group => {\n          tpl += `<section style=\"display: flex;\">\n        <section style=\"width: 100px;overflow:hidden;margin-right:5px;\">${group.text}</section>\n        <section style=\"width: 40px;\">${group.func_cnt}</section>\n        <section style=\"width: 40px;\">${group.tech_cnt}</section>\n        <section style=\"width: 40px;\">${group.other_cnt}</section>\n        <section style=\"width: 40px;\">${group.bug_cnt}</section>\n    </section>`;\n        });\n      }\n      return tpl;\n    },\n    groupToolTip(task) {\n      let tpl = `<header style=\"display: flex;\">\n        <section style=\"width: 40px;\">功能</section>\n        <section style=\"width: 40px;\">技术</section>\n        <section style=\"width: 40px;\">其他</section>\n        <section style=\"width: 40px;\">bug</section>\n    </header>\n    <section style=\"display: flex;\">\n        <section style=\"width: 40px;\">${task.func_cnt}</section>\n        <section style=\"width: 40px;\">${task.tech_cnt}</section>\n        <section style=\"width: 40px;\">${task.other_cnt}</section>\n        <section style=\"width: 40px;\">${task.bug_cnt}</section>\n    </section>`;\n      return tpl;\n    }\n  }\n};","map":{"version":3,"names":["gantt","name","props","mainData","Array","data","mainGanttData","links","id","text","start_date","demand","duration","parent","mounted","handleGantt","watch","methods","self","config","columns","label","align","width","tree","template","obj","storylink","show_errors","readonly","xml_date","date_scale","subscales","unit","step","date","duration_unit","duration_step","plugins","tooltip","marker","init","$refs","clearAll","parse","length","eachTask","task","$open","render","setGanttTaskCSS","setGanttTooltip","setGanttMarker","templates","task_text","start","end","func_cnt","work_time","task_class","tooltip_text","type","handleTooltipClient","groupToolTip","addMarker","Date","css","ganttObj","ted_time","tpl","tech_cnt","other_cnt","bug_cnt","groupInfo","forEach","group"],"sources":["src/components/Gantt/Gantetu.vue"],"sourcesContent":["<template>\r\n  <div ref=\"gantt\"></div>\r\n</template>\r\n \r\n<script>\r\nimport {gantt} from 'dhtmlx-gantt';\r\nimport \"dhtmlx-gantt/codebase/dhtmlxgantt.css\";\r\nexport default {\r\n  name: 'gantt',\r\n  props: {\r\n    mainData: Array,\r\n  },\r\ndata() {\r\n    return {\r\n      mainGanttData: {\r\n        data: [],\r\n        links: [],\r\n      },\r\n      // demo数据\r\n      mainGanttData:{\r\n        data:[\r\n      {\r\n        id: \"client\",\r\n        text: \"客户端\",\r\n        start_date: \"2020-4-12\",\r\n        demand: \"-\",\r\n        duration: 3,\r\n      },\r\n      {\r\n        id: \"web\",\r\n        text: \"Web开发组\",\r\n        start_date: \"2020-4-12\",\r\n        demand: \"-\",\r\n        duration: 1,\r\n        parent: \"client\",\r\n      },\r\n      {\r\n        id: \"sakurahuang\",\r\n        text: \"sakurahuang\",\r\n        start_date: \"2020-4-12\",\r\n        demand: \"联系我小程序插件的cgi从node迁移到hiweb\",\r\n        duration: 1,\r\n        parent: \"web\",\r\n      },\r\n      {\r\n        id: \"sakurahuang1\",\r\n        text: \"\",\r\n        start_date: \"2020-4-12\",\r\n        demand: \"自研白板\",\r\n        duration: 1,\r\n        parent: \"sakurahuang\",\r\n      },\r\n      {\r\n        id: \"tdreamhuang\",\r\n        text: \"tdreamhuang\",\r\n        start_date: \"2020-4-12\",\r\n        demand: \"联系我小程序插件的cgi从node迁移到hiweb\",\r\n        duration: 1,\r\n        parent: \"web\",\r\n      },\r\n        ],\r\n        links: [],\r\n      },\r\n    };\r\n  },\r\n  mounted() {\r\n    this.handleGantt();\r\n  },\r\n  watch: {\r\n    mainData() {\r\n      this.handleGantt();\r\n    },\r\n  },\r\n  methods: {\r\n    handleGantt() {\r\n      this.mainGanttData[\"data\"] = this.mainData;\r\n      const self = this;\r\n      // 这里设置左边列的标题，宽度，标题对齐方式\r\n      gantt.config.columns = [\r\n        {\r\n          name: \"text\",\r\n          label: \"所属中心\",\r\n          align: \"left\",\r\n          width: 200,\r\n          tree: true,\r\n          template: function (obj) {\r\n            return obj.text;\r\n          },\r\n        },\r\n        {\r\n          name: \"text\",\r\n          label: \"标题/备注\",\r\n          align: \"center\",\r\n          width: 200,\r\n          template: function (obj) {\r\n            if (obj.demand) {\r\n              return `<a href=\"${obj.storylink}\" target=\"_blank\">${obj.demand}</a>`;\r\n            }\r\n          },\r\n        },\r\n      ];\r\n      // 禁用红色弹框\r\n      gantt.config.show_errors = false;\r\n      // 只读模式\r\n      gantt.config.readonly = true;\r\n      // 设置日期格式，以及步长\r\n      gantt.config.xml_date = \"%Y-%m-%d\";\r\n      gantt.config.date_scale = \"%Y-%m\";\r\n      gantt.config.subscales = [\r\n        {\r\n          unit: \"day\",\r\n          step: 1,\r\n          date: \"%d\",\r\n        },\r\n      ];\r\n      gantt.config.duration_unit = \"day\";\r\n      gantt.config.duration_step = 1;\r\n\r\n      // 使用气泡和竖线要在这里加配置\r\n      gantt.plugins({\r\n        tooltip: true,\r\n        marker: true,\r\n      });\r\n\r\n      gantt.init(this.$refs.gantt);\r\n      // console.log(\"mainGanttData\");\r\n      // console.log(this.mainGanttData);\r\n      // 这里要清一下，不然2个版本互切的时候，任务会相互影响\r\n      gantt.clearAll();\r\n      gantt.parse(this.mainGanttData);\r\n      if (this.mainGanttData.data.length === 0) {\r\n        gantt.clearAll();\r\n      }\r\n      gantt.eachTask(function (task) {\r\n        task.$open = true;\r\n      });\r\n      gantt.render();\r\n      // 设置柱形工作条颜色和文字\r\n      this.setGanttTaskCSS(gantt);\r\n      // 设置鼠标悬浮气泡\r\n      this.setGanttTooltip(gantt);\r\n\r\n      // 设置竖线\r\n      this.setGanttMarker(gantt);\r\n\r\n      // gantt.attachEvent(\"onError\", function (errorMessage) {\r\n      //   debugger;\r\n      //   return true;\r\n      // });\r\n    },\r\n    setGanttTaskCSS(gantt) {\r\n      gantt.templates.task_text = function (start, end, task) {\r\n        if (task.func_cnt || task.func_cnt === 0) {\r\n          return `功能需求&技术需求：${task.func_cnt}个，工时： ${task.work_time} d`;\r\n        } else {\r\n          return \"工时\" + task.work_time + \"d\";\r\n        }\r\n        // return \"<b>Text:</b> \"+task.text+\",<b> Holders:</b> \"+task.users;\r\n      };\r\n      gantt.templates.task_class = function (start, end, task) {\r\n        if (task.func_cnt || task.func_cnt === 0) {\r\n          return \"gantt_group_task_color\";\r\n        }\r\n      };\r\n    },\r\n    setGanttTooltip(gantt) {\r\n      const self = this;\r\n      gantt.templates.tooltip_text = function (start, end, task) {\r\n        // https://docs.dhtmlx.com/chart__dhxtooltip.html\r\n        if (task.type === \"client\") {\r\n          return self.handleTooltipClient(task);\r\n        } else if (task.type === \"group\") {\r\n          return self.groupToolTip(task);\r\n        }\r\n      };\r\n    },\r\n    setGanttMarker(gantt) {\r\n      gantt.addMarker({\r\n        start_date: new Date(),\r\n        css: \"gantt_today_marker\",\r\n        text: \"今日\",\r\n      });\r\n      if (this.ganttObj.ted_time) {\r\n        gantt.addMarker({\r\n          start_date: new Date(this.ganttObj.ted_time),\r\n          css: \"gantt_GM_Exper_marker\",\r\n          text: \"ted体验\",\r\n        });\r\n      }\r\n    },\r\n    handleTooltipClient(task) {\r\n      let tpl = `<header style=\"display: flex;\">\r\n        <section style=\"width: 100px;\"></section>\r\n        <section style=\"width: 40px;\">功能</section>\r\n        <section style=\"width: 40px;\">技术</section>\r\n        <section style=\"width: 40px;\">其他</section>\r\n        <section style=\"width: 40px;\">bug</section>\r\n    </header>\r\n    <section style=\"display: flex;\">\r\n        <section style=\"width: 100px;margin-right:5px;\">总和</section>\r\n        <section style=\"width: 40px;\">${task.func_cnt}</section>\r\n        <section style=\"width: 40px;\">${task.tech_cnt}</section>\r\n        <section style=\"width: 40px;\">${task.other_cnt}</section>\r\n        <section style=\"width: 40px;\">${task.bug_cnt}</section>\r\n    </section>`;\r\n      if (task.groupInfo && task.groupInfo.length > 0) {\r\n        task.groupInfo.forEach((group) => {\r\n          tpl += `<section style=\"display: flex;\">\r\n        <section style=\"width: 100px;overflow:hidden;margin-right:5px;\">${group.text}</section>\r\n        <section style=\"width: 40px;\">${group.func_cnt}</section>\r\n        <section style=\"width: 40px;\">${group.tech_cnt}</section>\r\n        <section style=\"width: 40px;\">${group.other_cnt}</section>\r\n        <section style=\"width: 40px;\">${group.bug_cnt}</section>\r\n    </section>`;\r\n        });\r\n      }\r\n      return tpl;\r\n    },\r\n    groupToolTip(task) {\r\n      let tpl = `<header style=\"display: flex;\">\r\n        <section style=\"width: 40px;\">功能</section>\r\n        <section style=\"width: 40px;\">技术</section>\r\n        <section style=\"width: 40px;\">其他</section>\r\n        <section style=\"width: 40px;\">bug</section>\r\n    </header>\r\n    <section style=\"display: flex;\">\r\n        <section style=\"width: 40px;\">${task.func_cnt}</section>\r\n        <section style=\"width: 40px;\">${task.tech_cnt}</section>\r\n        <section style=\"width: 40px;\">${task.other_cnt}</section>\r\n        <section style=\"width: 40px;\">${task.bug_cnt}</section>\r\n    </section>`;\r\n      return tpl;\r\n    },\r\n  }\r\n}\r\n</script>\r\n \r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}