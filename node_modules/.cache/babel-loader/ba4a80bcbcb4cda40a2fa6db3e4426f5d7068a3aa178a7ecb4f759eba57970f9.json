{"ast":null,"code":"import { getUserCode, userLogin } from \"@/api/user/index\";\nimport { Message } from \"element-ui\";\nimport { mapActions } from 'vuex';\nexport default {\n  data() {\n    return {\n      formData: {\n        username: \"admin\",\n        password: 123456,\n        Verificationcode: undefined,\n        phone: \"\"\n      },\n      rules: {\n        username: [{\n          required: true,\n          message: '请输入用户名',\n          trigger: 'blur'\n        }],\n        password: [{\n          required: true,\n          message: '请输入密码',\n          trigger: 'blur'\n        }],\n        phone: [{\n          required: true,\n          message: '请输入手机号',\n          trigger: 'blur'\n        }],\n        Verificationcode: [{\n          required: true,\n          message: '请输入验证码',\n          trigger: 'blur'\n        }]\n      },\n      percentage: \"65%\",\n      countdown: 0,\n      buttonText: \"获取验证码\",\n      code: 0 //获取的验证码\n    };\n  },\n\n  computed: {},\n  methods: {\n    ...mapActions(['login']),\n    submitForm() {\n      this.$refs['elForm'].validate(valid => {\n        if (!valid) return;\n        // TODO 提交表单'\n        if (this.formData.Verificationcode == this.code) {\n          this.login(this.formData);\n        } else {\n          Message({\n            message: '验证码错误',\n            type: \"error\",\n            duration: 3000\n          });\n        }\n      });\n    },\n    //提交校验\n    resetForm() {\n      this.$refs['elForm'].resetFields();\n    },\n    //获取验证码\n    getCode() {\n      if (this.countdown == 0 && this.formData.phone != \"\") {\n        this.checkPhoneNumber(this.formData.phone);\n      } else if (this.formData.phone == \"\") {\n        this.submitForm();\n        Message({\n          message: \"请填写手机号\",\n          type: \"error\",\n          duration: 3000\n        });\n      } else {\n        Message({\n          message: this.buttonText,\n          type: \"error\",\n          duration: 3000\n        });\n      }\n    },\n    //按钮倒计时\n    startCountdown() {\n      if (this.countdown > 0) {\n        return;\n      } else {\n        this.countdown = 60;\n        this.buttonText = `${this.countdown} 秒后获取`;\n        this.percentage = '63%';\n        const intervalId = setInterval(() => {\n          this.countdown--;\n          this.buttonText = `${this.countdown} 秒后获取`;\n          this.percentage = '63%';\n          if (this.countdown === 0) {\n            clearInterval(intervalId);\n            this.buttonText = '获取验证码';\n            this.percentage = '65%';\n          }\n        }, 1000);\n      }\n    },\n    checkPhoneNumber(phoneNumber) {\n      // 以 1 开头，后面跟 10 位数字\n      const reg = /^(?:(?:\\+|00)86)?1(?:(?:3[\\d])|(?:4[5-79])|(?:5[0-35-9])|(?:6[5-7])|(?:7[0-8])|(?:8[\\d])|(?:9[1589]))\\d{8}$/;\n      console.log('reg.test(phoneNumber)', phoneNumber);\n      if (reg.test(phoneNumber)) {\n        getUserCode({\n          phone: this.formData.phone\n        }).then(res => {\n          console.log(res);\n          if (res.code == 200) {\n            this.code = res.data;\n          }\n          this.startCountdown();\n        });\n      } else {\n        Message({\n          message: '手机号有误',\n          type: \"error\",\n          duration: 3000\n        });\n      }\n    }\n  }\n};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}